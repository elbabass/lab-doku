# Tests Session 20251111_03 - Phase 1 MVP Core Mechanics

**Date** : 2025-11-11
**Phase** : Phase 1 - MVP Core mechanics
**Branche** : `main` (ou `phase-1-mvp` si décision de brancher)

## Contexte

### État actuel du projet

- ✅ Phase 0 complète (projet Godot, structure, autoloads, validation)
- ✅ GameManager et EventBus configurés
- ✅ Tous les tests de validation passent
- Prêt pour Phase 1 : Implémentation des mécaniques de base

### Dépendances

- [x] Phase 0 complète
- [x] Autoloads GameManager et EventBus fonctionnels
- [x] Documentation GODOT_PROTO_SPECS.md et ARCHITECTURE.md
- [x] Script de validation validate_setup.sh

## Objectifs de la session

### Priorité HAUTE (obligatoires)

#### Problème 1 : Implémenter GridManager

**Description** :

Créer le système de gestion de la grille 4x4 avec état des cellules (vide, pré-remplie, remplie par joueur).

**Critères de succès** :

- [ ] Fichier `scripts/game/grid_manager.gd` créé
- [ ] Classe `GridManager` extends Node
- [ ] Propriété `grid: Array[Array]` (4x4) avec type des cellules
- [ ] Méthode `initialize_grid(prefilled: Dictionary)` pour setup initial
- [ ] Méthode `get_cell(pos: Vector2i) -> Dictionary` retourne état cellule
- [ ] Méthode `set_cell(pos: Vector2i, number: int, is_player: bool) -> void`
- [ ] Signal émis via EventBus lors des changements
- [ ] Tests unitaires de base (si temps)

**Tests à effectuer** :

- [ ] **Test automatique - Build** :

  ```bash
  /Applications/Godot.app/Contents/MacOS/Godot --headless --quit --path .
  # Aucune erreur de compilation
  ```

- [ ] **Test manuel** :
  1. Créer scène de test `scenes/game/test_grid.tscn`
  2. Ajouter GridManager en enfant
  3. Initialiser grille avec 5-6 cellules pré-remplies
  4. Vérifier get_cell() retourne bonnes valeurs
  5. Vérifier set_cell() modifie grille
  6. Vérifier signaux émis dans Output panel

**Temps estimé** : 10-15 min

---

#### Problème 2 : Implémenter PlayerController (déplacement de base)

**Description** :

Créer le système de contrôle du joueur avec déplacement sur la grille (sans validation de clés pour l'instant).

**Critères de succès** :

- [ ] Fichier `scripts/game/player_controller.gd` créé
- [ ] Classe `PlayerController` extends Node2D
- [ ] Propriété `current_position: Vector2i` (position sur grille)
- [ ] Méthode `move_to(target: Vector2i) -> bool` (validation adjacence)
- [ ] Méthode `_input(event)` pour input clavier (flèches/WASD)
- [ ] Signal `player_moved` émis via EventBus
- [ ] Représentation visuelle basique (ColorRect ou Sprite)
- [ ] Clamp position dans limites grille (0-3)

**Tests à effectuer** :

- [ ] **Test automatique - Build** :

  ```bash
  /Applications/Godot.app/Contents/MacOS/Godot --headless --quit --path .
  ```

- [ ] **Test manuel** :
  1. Ajouter PlayerController à scène test
  2. Définir position initiale (ex: Vector2i(0, 0))
  3. Lancer jeu (F5)
  4. Tester déplacement avec flèches/WASD
  5. Vérifier limites grille (ne sort pas de 0-3)
  6. Vérifier adjacence (pas de diagonales, pas de saut)
  7. Vérifier signal player_moved dans Output

**Temps estimé** : 10-15 min

---

#### Problème 3 : Implémenter KeyManager (gestion des clés)

**Description** :

Créer le système de gestion des clés du joueur (possession, ajout, vérification).

**Critères de succès** :

- [ ] Fichier `scripts/game/key_manager.gd` créé
- [ ] Classe `KeyManager` extends Node
- [ ] Propriété `keys: Dictionary` (ex: {1: true, 2: false, 3: false, 4: false})
- [ ] Méthode `has_key(number: int) -> bool`
- [ ] Méthode `add_key(number: int) -> void`
- [ ] Méthode `remove_key(number: int) -> void` (pour mécaniques futures)
- [ ] Méthode `initialize_keys(starting_keys: Array[int])` (défaut: 2 clés aléatoires)
- [ ] Signal `key_obtained` émis via EventBus
- [ ] UI basique pour afficher clés (Label ou CheckBoxes)

**Tests à effectuer** :

- [ ] **Test automatique - Build** :

  ```bash
  /Applications/Godot.app/Contents/MacOS/Godot --headless --quit --path .
  ```

- [ ] **Test manuel** :
  1. Ajouter KeyManager à scène test
  2. Initialiser avec 2 clés aléatoires
  3. Vérifier has_key() retourne true/false correctement
  4. Tester add_key() ajoute clé
  5. Vérifier signal key_obtained émis
  6. Vérifier UI affiche état des clés

**Temps estimé** : 8-12 min

---

### Priorité MOYENNE (si temps disponible)

#### Problème 4 : Intégrer validation de clés dans déplacement

**Description** :

Connecter PlayerController et KeyManager pour bloquer déplacements sans clé.

**Critères de succès** :

- [ ] PlayerController vérifie KeyManager avant move_to()
- [ ] Déplacement bloqué si clé manquante
- [ ] Feedback visuel (message, couleur, son placeholder)

**Temps estimé** : 5-8 min

---

## Tests de validation globale

Après tous les problèmes, exécuter :

```bash
# Validation complète Phase 0
./scripts/validate_setup.sh

# Build Godot
/Applications/Godot.app/Contents/MacOS/Godot --headless --quit --path .

# Markdown linting
npx markdownlint-cli2 "**/*.md"

# Tests manuels intégration
# 1. Lancer jeu (F5)
# 2. Déplacer joueur avec clavier
# 3. Vérifier blocage si clé manquante (si Problème 4 fait)
# 4. Vérifier signaux dans Output panel
```

## Critères de succès globaux

- [ ] Tous les scripts compilent sans erreurs
- [ ] Grille 4x4 affichée et fonctionnelle
- [ ] Joueur se déplace avec input clavier
- [ ] Système de clés fonctionnel
- [ ] Signaux EventBus correctement émis
- [ ] 0 erreurs markdown linting
- [ ] Au moins 1 commit (feat ou wip si incomplet)

## Notes pré-session

- **Branche** : Décider si créer `phase-1-mvp` ou rester sur `main`
- **UI** : Placeholder minimal accepté (ColorRect, Label)
- **Assets** : Pas besoin de sprites, utiliser formes colorées
- **Tests unitaires** : Si temps, sinon reporter à session future
- **Validation** : Focus sur fonctionnel, pas sur visuel
