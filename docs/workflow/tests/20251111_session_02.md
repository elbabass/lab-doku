# Tests Session 20251111_02 - Setup Godot Phase 0

**Date** : 2025-11-11
**Phase** : Phase 0 - Setup et architecture
**Branche** : `main`

## Contexte

### √âtat actuel du projet

- Documentation compl√®te (conventions, architecture, workflow)
- Pas de projet Godot initialis√©
- Pr√™t pour Phase 0 : Setup infrastructure

### D√©pendances

- [x] Godot 4.x install√© sur la machine
- [x] Documentation technique compl√®te (GODOT_PROTO_SPECS.md)
- [x] Conventions d√©finies (CONVENTIONS.md, ARCHITECTURE.md)

## Objectifs de la session

### Priorit√© HAUTE (obligatoires)

#### Probl√®me 1 : Initialiser projet Godot 4.x

**Description** :

Cr√©er le fichier `project.godot` avec configuration de base pour d√©marrer le d√©veloppement.

**Crit√®res de succ√®s** :

- [ ] Fichier `project.godot` cr√©√© √† la racine
- [ ] Configuration de base : nom projet, r√©solution, orientation
- [ ] Projet s'ouvre dans Godot sans erreurs
- [ ] Fichier `.gitignore` adapt√© pour Godot (.godot/, *.import, etc.)

**Tests √† effectuer** :

- [ ] **Test automatique - Build** :

  ```bash
  # V√©rifier que le projet build sans erreurs
  godot --headless --check-only --path .
  ```

- [ ] **Test manuel** :
  1. Ouvrir Godot 4.x
  2. Ouvrir le projet (File > Open Project)
  3. V√©rifier que le projet se charge sans erreurs

**Complexit√©** : Simple

#### Probl√®me 2 : Cr√©er structure de dossiers

**Description** :

Cr√©er tous les dossiers n√©cessaires selon l'organisation d√©finie dans CONVENTIONS.md.

**Crit√®res de succ√®s** :

- [ ] Dossiers `scripts/` avec sous-dossiers (autoloads, game, ui, effects, utils)
- [ ] Dossiers `scenes/` avec sous-dossiers (game, ui, effects)
- [ ] Dossiers `tests/` avec sous-dossiers (unit, integration)
- [ ] Dossiers `assets/` avec sous-dossiers (sprites, sounds, fonts)

**Tests √† effectuer** :

- [ ] **Test automatique - Structure** :

  ```bash
  # G√©n√©rer l'arbre actuel
  tree -d -L 2 scripts scenes tests assets > /tmp/actual_tree.txt

  # Comparer avec structure attendue
  cat > /tmp/expected_tree.txt << 'EOF'
  scripts
  ‚îú‚îÄ‚îÄ autoloads
  ‚îú‚îÄ‚îÄ effects
  ‚îú‚îÄ‚îÄ game
  ‚îú‚îÄ‚îÄ ui
  ‚îî‚îÄ‚îÄ utils
  scenes
  ‚îú‚îÄ‚îÄ effects
  ‚îú‚îÄ‚îÄ game
  ‚îî‚îÄ‚îÄ ui
  tests
  ‚îú‚îÄ‚îÄ integration
  ‚îî‚îÄ‚îÄ unit
  assets
  ‚îú‚îÄ‚îÄ fonts
  ‚îú‚îÄ‚îÄ sounds
  ‚îî‚îÄ‚îÄ sprites
  EOF

  # V√©rifier correspondance (ignorer cosm√©tique)
  diff -w /tmp/expected_tree.txt /tmp/actual_tree.txt
  ```

- [ ] **Test manuel - FileSystem Godot** :
  1. V√©rifier dans l'√©diteur Godot que tous les dossiers sont visibles

**Complexit√©** : Tr√®s simple

#### Probl√®me 3 : Configurer autoloads de base

**Description** :

Cr√©er les stubs GDScript pour GameManager et EventBus, puis les configurer comme autoloads.

**Crit√®res de succ√®s** :

- [ ] Fichier `scripts/autoloads/game_manager.gd` cr√©√© avec classe de base
- [ ] Fichier `scripts/autoloads/event_bus.gd` cr√©√© avec classe de base
- [ ] Autoloads configur√©s dans Project Settings > Autoload
- [ ] Projet se lance et affiche autoloads dans Remote tab

**Tests √† effectuer** :

- [ ] **Test automatique - Lint GDScript** :

  ```bash
  # V√©rifier syntaxe GDScript (si gdlint install√©)
  gdlint scripts/autoloads/game_manager.gd
  gdlint scripts/autoloads/event_bus.gd

  # Alternative : v√©rifier avec Godot
  godot --headless --check-only --path . --script scripts/autoloads/game_manager.gd
  godot --headless --check-only --path . --script scripts/autoloads/event_bus.gd
  ```

- [ ] **Test automatique - Build avec autoloads** :

  ```bash
  # V√©rifier que le projet build avec autoloads configur√©s
  godot --headless --check-only --path .
  # Doit afficher "GameManager initialized" et "EventBus initialized" dans logs
  ```

- [ ] **Test manuel** :
  1. Lancer le projet (F5)
  2. V√©rifier Remote tab : GameManager et EventBus pr√©sents
  3. V√©rifier console : messages "initialized" affich√©s

**Complexit√©** : Simple

## Tests automatisables - R√©capitulatif

### Script de validation complet

Cr√©er `scripts/validate_setup.sh` pour automatiser tous les tests :

```bash
#!/bin/bash
set -e

echo "=== Validation Setup Godot Phase 0 ==="

# Test 1: Fichier project.godot existe
echo "[1/5] V√©rification project.godot..."
if [ -f "project.godot" ]; then
    echo "‚úÖ project.godot existe"
else
    echo "‚ùå project.godot manquant"
    exit 1
fi

# Test 2: Build Godot sans erreurs
echo "[2/5] Build Godot..."
if godot --headless --check-only --path . 2>&1 | grep -i "error"; then
    echo "‚ùå Erreurs de build d√©tect√©es"
    exit 1
else
    echo "‚úÖ Build OK"
fi

# Test 3: Structure de dossiers
echo "[3/5] V√©rification structure..."
REQUIRED_DIRS=(
    "scripts/autoloads"
    "scripts/game"
    "scripts/ui"
    "scripts/effects"
    "scripts/utils"
    "scenes/game"
    "scenes/ui"
    "scenes/effects"
    "tests/unit"
    "tests/integration"
    "assets/sprites"
    "assets/sounds"
    "assets/fonts"
)

for dir in "${REQUIRED_DIRS[@]}"; do
    if [ ! -d "$dir" ]; then
        echo "‚ùå Dossier manquant: $dir"
        exit 1
    fi
done
echo "‚úÖ Structure compl√®te"

# Test 4: Fichiers autoloads existent
echo "[4/5] V√©rification autoloads..."
if [ ! -f "scripts/autoloads/game_manager.gd" ]; then
    echo "‚ùå game_manager.gd manquant"
    exit 1
fi
if [ ! -f "scripts/autoloads/event_bus.gd" ]; then
    echo "‚ùå event_bus.gd manquant"
    exit 1
fi
echo "‚úÖ Autoloads pr√©sents"

# Test 5: Markdown linting
echo "[5/5] Linting markdown..."
if npx markdownlint-cli2 "**/*.md" 2>&1 | grep "error"; then
    echo "‚ùå Erreurs markdown d√©tect√©es"
    exit 1
else
    echo "‚úÖ Markdown OK"
fi

echo ""
echo "üéâ Tous les tests passent !"
```

**Usage** :

```bash
chmod +x scripts/validate_setup.sh
./scripts/validate_setup.sh
```

## D√©tails techniques

### Fichiers √† cr√©er

**Configuration Godot** :

- `project.godot` - Configuration projet
- `.gitignore` - Ignorer fichiers Godot temporaires

**Structure scripts** :

- `scripts/autoloads/game_manager.gd`
- `scripts/autoloads/event_bus.gd`

**Validation** :

- `scripts/validate_setup.sh` - Script de tests automatis√©s

### Configuration project.godot (minimal)

```ini
config_version=5

[application]

config/name="lab-doku"
run/main_scene="res://scenes/main.tscn"
config/features=PackedStringArray("4.3", "Forward Plus")

[autoload]

GameManager="*res://scripts/autoloads/game_manager.gd"
EventBus="*res://scripts/autoloads/event_bus.gd"

[display]

window/size/viewport_width=1280
window/size/viewport_height=720
window/stretch/mode="canvas_items"
```

### Stubs autoloads

**game_manager.gd** :

```gdscript
extends Node

## G√®re l'√©tat global du jeu et coordination des syst√®mes.

func _ready() -> void:
    print("GameManager initialized")
```

**event_bus.gd** :

```gdscript
extends Node

## Hub centralis√© pour la communication inter-syst√®mes via signaux.

func _ready() -> void:
    print("EventBus initialized")
```

## Crit√®res de compl√©tion

### D√©finition of Done

- [ ] Fichier `project.godot` existe et est configur√©
- [ ] Structure de dossiers compl√®te selon CONVENTIONS.md
- [ ] Autoloads GameManager et EventBus cr√©√©s et configur√©s
- [ ] **Script `validate_setup.sh` cr√©√© et tous les tests passent**
- [ ] Projet Godot build sans erreurs (`godot --headless --check-only`)
- [ ] Linter markdown passe (0 erreurs)
- [ ] Au moins 1 commit effectu√©
- [ ] Fichier de r√©tro cr√©√© (RETRO_SESSION_CONCISE.md)

## Risques identifi√©s

### Risque 1 : Commande `tree` non disponible

- **Probabilit√©** : Moyenne (d√©pend de l'OS)
- **Impact** : Faible (test structure non automatisable)
- **Mitigation** : Utiliser `ls -R` ou `find` comme alternative
- **Plan B** : Test manuel uniquement

### Risque 2 : gdlint non install√©

- **Probabilit√©** : √âlev√©e (pas d'installation pr√©alable)
- **Impact** : Faible (fallback sur `godot --check-only`)
- **Mitigation** : Utiliser validation Godot int√©gr√©e
- **Plan B** : Linting via Godot uniquement

## Notes de pr√©paration

### Documentation √† consulter

- [ ] `docs/godot/CONVENTIONS.md` (structure dossiers)
- [ ] `docs/godot/ARCHITECTURE.md` (autoloads)
- [ ] `docs/GODOT_PROTO_SPECS.md` (param√®tres projet)
- [ ] [Godot CLI](https://docs.godotengine.org/en/stable/tutorials/editor/command_line_tutorial.html)

### Questions √† r√©soudre avant de commencer

1. Godot 4.x est-il install√© et quelle version exacte ?
   - Commande : `godot --version`

2. Commande `tree` disponible ?
   - Alternative macOS : `brew install tree`
   - Alternative Linux : `apt install tree` / `yum install tree`
   - Fallback : `find . -type d -maxdepth 3 | sort`

---

**Fichier de tests cr√©√© le** : 2025-11-11
**Dur√©e** : No-estimate (mesure apr√®s session)
**Complexit√© globale** : Simple (setup standard + scripts validation)
